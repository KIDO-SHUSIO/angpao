<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ซองอั่งเปาออนไลน์</title>
<style>
body{
    font-family: sans-serif;
    text-align:center;
    background:#fff;
}
.box{
    width:260px;
    margin:20px auto;
    border:5px solid #000;
    padding:20px;
}
img{
    width:100%;
    display:none;
}
input,button{
    font-size:18px;
    padding:10px;
    margin:10px;
    border:3px solid #000;
}
button{
    background:#fff;
    cursor:pointer;
}
.hidden{display:none;}
</style>
</head>
<body>

<div id="create">
    <div class="box">
        <input type="file" id="imgInput"><br>
        <img id="preview">
    </div>

    <input type="text" id="wish" placeholder="คำอวยพร"><br>

    <button onclick="makeLink()">สร้างซองอั่งเปา</button>
</div>

<div id="result" class="hidden">
    <div class="box">
        <img id="showImg">
        <p id="showWish"></p>
    </div>
    <input id="linkBox" readonly>
    <button onclick="copyLink()">copy link</button>
</div>

<script>
const params = new URLSearchParams(window.location.search);
if(params.get("img")){
    document.getElementById("create").style.display="none";
    document.getElementById("result").classList.remove("hidden");
    document.getElementById("showImg").src = params.get("img");
    document.getElementById("showImg").style.display="block";
    document.getElementById("showWish").innerText = params.get("wish");
}

let imgData="";

document.getElementById("imgInput").addEventListener("change",e=>{
    const file=e.target.files[0];
    const reader=new FileReader();
    reader.onload=()=>{
        imgData=reader.result;
        document.getElementById("preview").src=imgData;
        document.getElementById("preview").style.display="block";
    }
    reader.readAsDataURL(file);
});

function makeLink(){
    const wish=document.getElementById("wish").value;
    if(!imgData || !wish){alert("กรอกข้อมูลให้ครบ");return;}
    const url=location.origin+location.pathname+
    "?img="+encodeURIComponent(imgData)+
    "&wish="+encodeURIComponent(wish);

    document.getElementById("result").classList.remove("hidden");
    document.getElementById("linkBox").value=url;
}

function copyLink(){
    const box=document.getElementById("linkBox");
    box.select();
    document.execCommand("copy");
    alert("คัดลอกลิงก์แล้ว!");
}
</script>

</body>
</html>
